# pg_hba.conf - Configuración de autenticación
# PostgreSQL 15 - Nodo Primario
# Proyecto: Sistema Alta Disponibilidad - Pollo Sanjuanero S.A.

# TIPO  BASE_DATOS    USUARIO           DIRECCIÓN         MÉTODO_AUTH

# "local" es para conexiones Unix domain socket únicamente
local   all           postgres                            trust
local   all           all                                 md5

# Conexiones IPv4 locales:
host    all           postgres          127.0.0.1/32      trust
host    all           all               127.0.0.1/32      md5

# Conexiones IPv6 locales:
host    all           all               ::1/128           md5

# Permite conexiones desde cualquier host (para Docker)
host    all           all               0.0.0.0/0         md5

# CONFIGURACIÓN DE REPLICACIÓN
# Permite conexiones de replicación desde usuarios replicator
# Desde cualquier IP de la red Docker (172.x.x.x)
host    replication   replicator        172.16.0.0/12     md5

# Para conexiones locales de replicación
local   replication   replicator                          md5
host    replication   replicator        127.0.0.1/32      md5
host    replication   replicator        ::1/128           md5

# Permite conexiones desde los contenedores Docker
# Red interna de Docker generalmente usa 172.x.x.x
host    replication   replicator        0.0.0.0/0         md5

# Configuración adicional para alta disponibilidad
# Permite que otros nodos se conecten para monitoreo
host    all           postgres          172.16.0.0/12     md5